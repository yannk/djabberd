
filter_incoming_client
    |
   \|/
switch_incoming_client
  |
  +-->  proceess_client_stanza   (if no to='' or to='' is for server)
  |
  +-->  deliver


filter_incoming_server
    |
   \|/
switch_incoming_server
  |
  +-->  proceess_server_stanza   (if to='' is for server)
  |
  +-->  deliver   ( same as earlier deliver )



